
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager navigationManager
@inject FinnanceApp.Client.Services.IPersonService PersonService
@layout MainLayout
@implements IDisposable
@attribute [Authorize]

<table class="table table-striped table-bordered" style="text-align:center;">

    <thead>
        <tr>
            <th id="a">Payer Name</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (FinnanceApp.Shared.Models.Person entry in PersonService.People)
        {
            <tr>
                <td>@entry.name</td>
                <td>
                    <a @onclick="@(() => EditPerson(entry.id,entry.name))"  class="btn btn-info btn-circle">
                                        <i style="color:white;" class="far fa-edit"></i>   </a>
                    <a @onclick="@(() => DeletePerson(entry.id,entry.name))" class="btn btn-danger btn-circle">
                                        <i style="color:white;" class="fas fa-trash"></i>  </a>
                </td>

            </tr>
        }
        <tr>
            <td>
                <input type="text" @bind="personName" name="name" placeholder="New Payer">
            </td>

            <td>
                <a @onclick="@(() => addPerson(personName))" class="btn btn-success btn-circle">
                                        <i style="color:white;" class="fas fa-check"></i> </a>
                                
            </td>
        </tr>
    </tbody>

</table>

<ConfirmComp Title=@("Delete Payer") Message=@($"Are you sure, do you want delete {deleteName}? This will delete all assigned Bills.") 
ConfirmChanged="ConfirmDeleteClick" @ref="DeleteConfirmation"></ConfirmComp>

<EditComp Title=@("Edit Payer") Message=@($"Enter a new name for {editName}.") 
ConfirmChanged="EditDeleteClick" @ref="EditConfirmation"></EditComp>  


@code {
    protected Modal DeleteConfirmation {get; set;}
    protected EditModal EditConfirmation {get; set;}
    private string personName {get; set;}
    private int deleteid {get; set;}
    private int editid {get;set;}
    private string editName {get;set;}
    private string deleteName {get; set;}
   
    
    protected override async Task OnInitializedAsync()
    {
        await PersonService.GetPersonList();
        PersonService.OnChange += StateHasChanged;
    }

    public void DeletePerson(int id, string name)
    {
     deleteName=name;
     deleteid=id;
     DeleteConfirmation.Show();
     
    }
    public void EditPerson(int id, string name)
    {
     editName=name;
     editid=id;
     EditConfirmation.Show();
     
    }
    protected async Task ConfirmDeleteClick(bool confirm)
    {
        if(confirm)
        {
         await PersonService.deletePerson(deleteid);
        }
    }
    protected async Task EditDeleteClick(string result)
    {
        if(!String.IsNullOrWhiteSpace(result))
        {
         await PersonService.editPerson(editid,result);
        }
    }
    async void addPerson(string name)
    {
        personName = null;
        var result = await PersonService.addPerson(name);
    }
   
    
    public void Dispose()
    {
        PersonService.OnChange -= StateHasChanged;
           }

       
}